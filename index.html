<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lambert W PWA</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: Arial, sans-serif; padding: 2em; }
    input, button { font-size: 1em; margin: 0.5em 0; }
    .result { margin-top: 1em; font-size: 1.2em; }
  </style>
  <!-- Load MathJax -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <h1>Lambert W Calculator</h1>
  <input type="number" id="xInput" placeholder="Enter x" step="any">
  <button id="calcBtn">Compute W(x)</button>
  <div class="result" id="result"></div>

  <script>
    // Lambert W approximation for both W0 and W-1 branches
    function lambertW(x, branch = 0) {
      if (x === 0) return 0;
      if (x === -1/Math.E) return -1;
      if (x < -1/Math.E) return NaN;

      let w;
      if (branch === 0) {
        w = Math.log1p(x);
      } else {
        w = Math.log(-x);
      }

      for (let i = 0; i < 50; i++) {
        let e = Math.exp(w);
        let f = w * e - x;
        let denom = e * (w + 1) - ((w + 2) * f) / (2 * (w + 1));
        let wNext = w - f / denom;
        if (Math.abs(wNext - w) < 1e-12) return wNext;
        w = wNext;
      }
      return w;
    }

    document.getElementById('calcBtn').addEventListener('click', () => {
      const x = parseFloat(document.getElementById('xInput').value);
      let output = "";

      if (isNaN(x)) {
        output = "Please enter a valid number.";
      } else if (x >= 0) {
        output = `$$W_0(${x}) \\approx ${lambertW(x, 0).toPrecision(12)}$$`;
      } else if (x >= -1/Math.E && x < 0) {
        output = `$$W_0(${x}) \\approx ${lambertW(x, 0).toPrecision(12)}$$<br>
                  $$W_{-1}(${x}) \\approx ${lambertW(x, -1).toPrecision(12)}$$`;
      } else {
        output = `No real Lambert W value for $${x}$.`;
      }

      document.getElementById('result').innerHTML = output;
      MathJax.typesetPromise(); // render LaTeX
    });

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker registered'))
        .catch(err => console.log('Service Worker registration failed:', err));
    }
  </script>
</body>
</html>